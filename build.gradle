// Live without gradle java plugin

final String SOURCEPATH = 'src/main/java'
final String BUILDPATH  = 'build/src/main/java/'

task beforeCompile() {
    "mkdir -p $BUILDPATH".execute().text
}

task compile() {
    def file = "$SOURCEPATH/org/dsaenz/oca/$chapter/${className}.java"
    runCommand "javac -g -sourcepath $SOURCEPATH -d $BUILDPATH $file"
}

task run() {
    def klass = "org.dsaenz.oca.${chapter}.$className"
    runCommand "java -cp $BUILDPATH $klass"
}

compile.dependsOn beforeCompile
run.dependsOn compile

def runCommand(command) {
    def sout = new StringBuilder(), serr = new StringBuilder()
    def proc = command.execute()
    proc.consumeProcessOutput(sout, serr)
    proc.waitFor()
    println sout
    println serr
}
